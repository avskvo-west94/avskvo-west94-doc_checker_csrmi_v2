# Структура проекта "Проверка документов ЦСРМИ"

## Обзор

Проект реализует настольное Windows-приложение на C# (.NET 8.0, WPF) для автоматической проверки Word документов на соответствие эталонным значениям.

## Архитектура

### Модели данных (`Models/`)

- **Template.cs** - Шаблон с эталонными значениями (11 полей)
- **Field.cs** - Поле шаблона с эталонным значением, допустимыми и ошибочными вариантами
- **Discrepancy.cs** - Несоответствие, найденное в документе
- **FieldDefinition.cs** - Определения стандартных 11 полей

### Сервисы (`Services/`)

- **TemplateService.cs** - Управление шаблонами (сохранение/загрузка из JSON)
- **DocumentCheckerService.cs** - Проверка Word документов на несоответствия
- **DocumentFixService.cs** - Автоматическое исправление несоответствий в документах
- **TextNormalizer.cs** - Нормализация текста для сравнения
- **FuzzyMatcher.cs** - Нечеткое сравнение строк (расстояние Левенштейна)

### Представления (`Views/`)

- **MainWindow.xaml/cs** - Главное окно приложения
- **TemplateManagementWindow.xaml/cs** - Управление шаблонами
- **TemplateSelectionWindow.xaml/cs** - Выбор шаблона
- **TemplateEditWindow.xaml/cs** - Редактирование шаблона
- **VariantsWindow.xaml/cs** - Управление допустимыми/ошибочными вариантами
- **LearningWindow.xaml/cs** - Добавление ошибочных вариантов (обучение)

### Конвертеры (`Converters/`)

- **DiscrepancyTypeConverter.cs** - Конвертер для отображения типа несоответствия

## Основные функции

### 1. Управление шаблонами
- Создание, редактирование, удаление шаблонов
- Клонирование шаблонов
- Управление допустимыми и ошибочными вариантами для каждого поля

### 2. Проверка документов
- Извлечение текста из параграфов и таблиц Word документа
- Нормализация текста для сравнения
- Поиск несоответствий:
  - Точные несовпадения
  - Опечатки (fuzzy match)
  - Известные ошибки
- Отображение результатов в таблице с фильтрацией

### 3. Автоматическое исправление
- Замена найденных несоответствий на эталонные значения
- Сохранение форматирования документа
- Поддержка работы с параграфами и таблицами

### 4. Механизм обучения
- Добавление новых ошибочных вариантов
- Автоматическое распознавание известных ошибок при проверке

## Технологии

- **.NET 8.0** - платформа разработки
- **WPF** - пользовательский интерфейс
- **DocumentFormat.OpenXml** (v3.0.1) - работа с Word документами
- **System.Text.Json** (v8.0.5) - сериализация данных

## Хранение данных

Шаблоны сохраняются в JSON-файле:
```
%APPDATA%\DocumentChecker\templates.json
```

## Алгоритм проверки

1. **Извлечение текста** из документа (параграфы, таблицы)
2. **Нормализация** текста (регистр, пробелы, спецсимволы)
3. **Сравнение** с эталонными значениями:
   - Точное совпадение
   - Совпадение с допустимыми вариантами
   - Fuzzy match (расстояние Левенштейна ≥ 0.85)
   - Совпадение с известными ошибками
4. **Формирование списка несоответствий** с контекстом и местоположением

## Алгоритм исправления

1. Группировка несоответствий по контейнеру (параграф/ячейка таблицы)
2. Извлечение текста из контейнера
3. Замена найденного текста на эталонное значение
4. Сохранение изменений в документе

## Особенности реализации

- Работа без установленного Microsoft Word (Open XML SDK)
- Нормализация текста для корректного сравнения
- Fuzzy matching для поиска опечаток
- Механизм обучения на новых ошибках
- Фильтрация результатов проверки
- Массовое исправление несоответствий

## Расширяемость

Проект легко расширяется:
- Добавление новых типов полей
- Настройка порогов fuzzy matching
- Добавление новых типов несоответствий
- Интеграция с внешними системами
